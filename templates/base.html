{% load user_extras %}
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Clínica{% endblock %}</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <style>
      :root{
        --glass: rgba(255,255,255,.72);
        --glass2: rgba(255,255,255,.52);
        --stroke: rgba(17,24,39,.08);
        --shadow: 0 12px 30px rgba(17,24,39,.10);
        --shadow2: 0 8px 18px rgba(17,24,39,.08);
      }
      body{
        background:
          radial-gradient(1200px 600px at 10% 0%, rgba(99,102,241,.16), transparent 55%),
          radial-gradient(900px 500px at 90% 10%, rgba(16,185,129,.12), transparent 55%),
          radial-gradient(800px 400px at 50% 100%, rgba(59,130,246,.10), transparent 55%),
          #f6f7fb;
      }
      .navbar{ box-shadow: 0 6px 18px rgba(0,0,0,.12); }
      .navbar .nav-link{ opacity:.92; }
      .navbar .nav-link:hover{ opacity:1; }
      .brand-dot{ width:10px; height:10px; border-radius:999px; background:#22c55e; display:inline-block; margin-left:.4rem; box-shadow:0 0 0 4px rgba(34,197,94,.15); }
      .muted{ color: rgba(17,24,39,.65); }
      .panel-glass{
        background: linear-gradient(180deg, var(--glass), var(--glass2));
        border: 1px solid var(--stroke);
        border-radius: 18px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
      }
      .card-soft{
        border-radius: 16px;
        box-shadow: var(--shadow2);
      }
      .btn-pill{ border-radius: 999px; }
      .table thead th{
        font-size:.86rem;
        text-transform: uppercase;
        letter-spacing:.03em;
      }
      .badge{ border-radius: 999px; }
      .link-muted{ color: rgba(255,255,255,.78); text-decoration:none; }
      .link-muted:hover{ color: #fff; }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand fw-semibold" href="{% url 'home' %}">
          Clínica <span class="brand-dot"></span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="nav">
          <ul class="navbar-nav me-auto">
            {% if user.is_authenticated %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'my_appointments' %}">
                  <i class="bi bi-calendar2-week me-1"></i> Mis Citas
                </a>
              </li>

              {% if not user|has_patient_profile %}
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'doctor_agenda' %}">
                    <i class="bi bi-calendar-event me-1"></i> Agenda
                  </a>
                </li>

                <li class="nav-item">
                  <a class="nav-link" href="{% url 'doctor_dashboard' %}">
                    <i class="bi bi-speedometer2 me-1"></i> Dashboard
                  </a>
                </li>

                <!-- ✅ NUEVO: Crear Paciente (solo Doctor/Admin, no paciente) -->
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'patient_create' %}">
                    <i class="bi bi-person-plus me-1"></i> Crear paciente
                  </a>
                </li>
              {% else %}
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'patient_history' %}">
                    <i class="bi bi-clock-history me-1"></i> Historial
                  </a>
                </li>
              {% endif %}
            {% endif %}
          </ul>

          <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-2">
            {% if user.is_authenticated %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'password_change' %}">
                  <i class="bi bi-shield-lock me-1"></i> Cambiar contraseña
                </a>
              </li>

              <li class="nav-item">
                <span class="navbar-text text-white-50">
                  <i class="bi bi-person-circle me-1"></i>{{ user.username }}
                </span>
              </li>

              <!-- ✅ Logout por POST (evita 405 Method Not Allowed) -->
              <li class="nav-item">
                <form method="post" action="{% url 'logout' %}" class="m-0">
                  {% csrf_token %}
                  <button class="btn btn-outline-light btn-sm btn-pill" type="submit">
                    <i class="bi bi-box-arrow-right me-1"></i> Salir
                  </button>
                </form>
              </li>
            {% else %}
              <li class="nav-item">
                <a class="nav-link link-muted" href="{% url 'login' %}">
                  <i class="bi bi-box-arrow-in-right me-1"></i> Entrar
                </a>
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <main class="container py-4">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}

      {% block content %}{% endblock %}
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
